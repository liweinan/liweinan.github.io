---
title: è§£å†³minikubeçš„ImagePullBackOffé—®é¢˜
---

é¦–å…ˆä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæ¥åˆ›å»ºminikubeçš„ç¾¤é›†:

```bash
$ minikube start --image-mirror-country=cn --memory='4gb'
```

ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æ²¡æœ‰ç½‘ç»œé—®é¢˜,å¦‚æœæ— æ³•æ­£å¸¸å®‰è£…å¯ä»¥å°è¯•é…ç½®ä¸€ä¸‹åº•å±‚dockerçš„ä»£ç†:

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/0AE4C4E2-3199-44E4-8F46-4BF4900AFD9F.png)

ç„¶åå°è¯•å®‰è£…`registry addon`:

```bash
â¤ minikube addons enable registry
```

å†æˆ‘çš„ç¯å¢ƒä¸‹,å…¶ä¸­ä¸€ä¸ªimageä¼šæ— æ³•æ­£å¸¸ä¸‹è½½(è™½ç„¶ä½¿ç”¨äº†é•œåƒ):

```bash
â¤ watch kubectl get po -A
```

æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸€ä¸ª`registry-proxy`çš„imageä¸€ç›´æ— æ³•æ‹‰å–. ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰¾åˆ°è¿™ä¸ªpodå…·ä½“ä½¿ç”¨çš„imageåç§°:

```
â¤ kubectl get po registry-proxy-5nr99 -n kube-system -o yaml | grep image
    image: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4@sha256:1040f25a5273de0d72c54865a8efd47e3292de9fb8e5353e3fa76736b854f2da
    imagePullPolicy: IfNotPresent
    image: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
    imageID: docker-pullable://registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy@sha256:1040f25a5273de0d72c54865a8efd47e3292de9fb8e5353e3fa76736b854f2da
```

äºæ˜¯ä½¿ç”¨`minikube`çš„æ‰‹å·¥æ‹‰å–imageå‘½ä»¤:

```bash
$ minikube image load registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
```

è¿™æ ·è¿™ä¸ªimageå°±å¯ä»¥è¢«æ‹‰å–ä¸‹æ¥,ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹image:

```bash
â¤ minikube image ls
```

å¯ä»¥çœ‹åˆ°imageå·²ç»æ‹‰å–ä¸‹æ¥äº†:

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/743538F3-D365-4E03-BC2B-C3BB2577DE45.png)

æ­¤æ—¶ä½¿ç”¨`kubectl`æ›¿æ¢æ‹‰å–å¤±è´¥çš„pod:

```bash
â¤ kubectl get po registry-proxy-lkfz5 -n kube-system -o yaml |  kubectl replace --force -f -
```

ç­‰å¾…ä¸€ä¼šå„¿å°±å¯ä»¥çœ‹åˆ°ç›¸å…³podè¢«æ›¿æ¢äº†:

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/E2C9CAD2-2A47-4BB0-A099-63C4277C1AFC.png)

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/39B7BFCE-DE27-4CC3-8F69-CEBEE2463FD1.png)

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/3B359FFB-59D6-4E5C-9EA7-527EAB84BEDE.png)

æ­¤æ—¶å†é‡æ–°enable addonå³å¯:

![](https://raw.githubusercontent.com/liweinan/blogpics2023/master/0601/AAA1AE06-4B03-4D2A-89AC-A3BBF235D602.png)

è¿™æ ·imageæ‹‰å–å¤±è´¥çš„é—®é¢˜å°±è§£å†³äº†.

---

è¡¥å……å†…å®¹:

æœ‰çš„æ—¶å€™ç›´æ¥ä¸¤ä¸ªimageså…¨éƒ½ä¸èƒ½æ­£å¸¸ä¸‹è½½:

```bash
kube-system   registry-proxy-kxfc6               0/1     ImagePullBackOff   0              91s
kube-system   registry-szxb9                     0/1     ImagePullBackOff   0              91s
```

æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸€ä¸ªä¸€ä¸ªæ”¶å·¥æ‹‰å–,å…ˆçœ‹`registry-proxy-kxfc6`:

```bash
â¤ kubectl get po registry-proxy-kxfc6 -n kube-system -o yaml | grep image
    image: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4@sha256:1040f25a5273de0d72c54865a8efd47e3292de9fb8e5353e3fa76736b854f2da
    imagePullPolicy: IfNotPresent
  - image: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4@sha256:1040f25a5273de0d72c54865a8efd47e3292de9fb8e5353e3fa76736b854f2da
    imageID: ""
        message: Back-off pulling image "registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4@sha256:1040f25a5273de0d72c54865a8efd47e3292de9fb8e5353e3fa76736b854f2da"
```

æ‰‹å·¥æ‹‰å–è¿™ä¸ªimage:

```bash
â¤ minikube image load registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
```

ç„¶åæ‹‰å–ç¬¬äºŒä¸ªimage:

```bash
â¤ kubectl get po registry-szxb9 -n kube-system -o yaml | grep image
    image: docker.io/registry:2.8.1@sha256:83bb78d7b28f1ac99c68133af32c93e9a1c149bcd3cb6e683a3ee56e312f1c96
    imagePullPolicy: IfNotPresent
    image: registry@sha256:83bb78d7b28f1ac99c68133af32c93e9a1c149bcd3cb6e683a3ee56e312f1c96
    imageID: docker-pullable://registry@sha256:83bb78d7b28f1ac99c68133af32c93e9a1c149bcd3cb6e683a3ee56e312f1c96
```

```bash
â¤ minikube image load docker.io/registry:2.8.1
```

æ£€æŸ¥ä¸€ä¸‹ç›¸å…³imageséƒ½å·²ç»æ‹‰å–äº†:

```bash
â¤ minikube image ls | grep proxy
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.26.3
weli@192:~/w/w/common|mainâš¡?
â¤ minikube image ls | grep registry
registry.cn-hangzhou.aliyuncs.com/google_containers/storage-provisioner:v5
registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.26.3
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.26.3
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.26.3
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.26.3
registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.6-0
registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.9.3
docker.io/library/registry:<none>
docker.io/library/registry:2.8.1
```

æ¥ä¸‹æ¥æ›¿æ¢ä¸¤ä¸ªpods:

```bash
â¤ kubectl get po registry-szxb9 -n kube-system -o yaml |  kubectl replace --force -f -
```

```bash
â¤ kubectl get po registry-proxy-kxfc6 -n kube-system -o yaml |  kubectl replace --force -f -
pod "registry-proxy-kxfc6" deleted
pod/registry-proxy-kxfc6 replaced
```

æ­¤æ—¶é‡æ–°å¯åŠ¨addon:

```bash
â¤ minikube addons disable registry
ğŸŒ‘  'registry' æ’ä»¶å·²è¢«ç¦ç”¨
weli@192:~/w/liweinan.github.io|masterâš¡*
â¤ minikube addons enable registry
ğŸ’¡  registry is an addon maintained by Google. For any concerns contact minikube on GitHub.
You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                                      â”‚
â”‚    Registry addon with docker driver uses port 62258 please use that instead of default port 5000    â”‚
â”‚                                                                                                      â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
ğŸ“˜  For more information see: https://minikube.sigs.k8s.io/docs/drivers/docker
    â–ª Using image registry.cn-hangzhou.aliyuncs.com/google_containers/kube-registry-proxy:0.4
    â–ª Using image docker.io/registry:2.8.1
ğŸ”  Verifying registry addon...
ğŸŒŸ  å¯åŠ¨ 'registry' æ’ä»¶
```

æŸ¥çœ‹æ’ä»¶è¿è¡Œæƒ…å†µ:

```bash
â¤ minikube addons list | grep registry
| registry                    | minikube | enabled âœ…   | Google                         |
| registry-aliases            | minikube | disabled     | 3rd party (unknown)            |
| registry-creds              | minikube | disabled     | 3rd party (UPMC Enterpr
```

å¯ä»¥çœ‹åˆ°å·²ç»æ­£å¸¸è¿è¡Œäº†ã€‚


